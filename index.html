<script>
    async function syncContent() {
        const parser = new DOMParser();

        // 1. 공지사항 3개 동기화 (기존과 동일)
        const notices = document.querySelectorAll('#notice-sync-list li');
        for (let li of notices) {
            const a = li.querySelector('a');
            const url = a.getAttribute('href');
            if (!url || url === "#") continue;
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error();
                const html = await res.text();
                const doc = parser.parseFromString(html, 'text/html');
                const title = doc.querySelector('h3');
                if (title) a.innerText = title.innerText;
                const dateMatch = doc.body.innerText.match(/\d{4}\.\s*\d{2}\.\s*\d{2}/);
                if (dateMatch) li.querySelector('.notice-date').innerText = dateMatch[0];
            } catch (e) { li.style.display = 'none'; }
        }

        // 2. 갤러리 최신글 1개 동기화 (이미지 경로 수정 로직 강화)
        const galleryBox = document.querySelector('#gallery-sync-box .gallery-link');
        try {
            const res = await fetch('gallery_view/gallery_view_1.html');
            if (!res.ok) throw new Error();
            const html = await res.text();
            const doc = parser.parseFromString(html, 'text/html');

            const title = doc.querySelector('h3') ? doc.querySelector('h3').innerText : "Update";
            
            // ✅ 핵심: 이미지 경로에서 ../ 를 제거하여 메인 페이지 기준 경로로 변경
            const imgElement = doc.querySelector('.gallery-photo-box img') || doc.querySelector('img');
            let imgSrc = "";
            if (imgElement) {
                const originalSrc = imgElement.getAttribute('src');
                // "../" 로 시작하면 그 부분을 지우고 images/ 로 시작하게 만듭니다.
                imgSrc = originalSrc.startsWith('../') ? originalSrc.substring(3) : originalSrc;
            }
            
            const boldMsg = doc.querySelector('strong') ? doc.querySelector('strong').innerText : "";
            const dateMatch = doc.body.innerText.match(/\d{4}\.\s*\d{2}\.\s*\d{2}/);

            galleryBox.innerHTML = `
                <img src="${imgSrc}" alt="Latest Gallery" onerror="this.src='images/logo.png';">
                <div class="gallery-preview-text">
                    <h4>${title}</h4>
                    <p><strong>${boldMsg}</strong></p>
                    <span class="notice-date">${dateMatch ? dateMatch[0] : ""}</span>
                </div>
            `;
        } catch (e) {
            console.log("Gallery sync failed.");
        }
    }

    window.addEventListener('DOMContentLoaded', syncContent);
</script>